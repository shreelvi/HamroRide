@model gurujiRide.Models.IndexViewModel
@{
    ViewData["Title"] = "Home Page";
}

<style>
    /* Recent requests small header and wide cards aligned to the right */
    .recent-requests-section h2 {
        font-size: 1.05rem; /* smaller header */
        margin-bottom: 6px;
    }

    .cards-grid {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end; /* align cards to right */
        gap: 12px;
    }

    .cards-grid .card {
        flex: 0 0 520px; /* wide cards so content fits on single line where possible */
        max-width: 520px;
        min-width: 380px;
    }

    /* Prevent long labels from wrapping; truncate with ellipsis if too long */
    .ride-card .card-text {
            /* truncate on wide screens only */
            overflow: hidden;
            text-overflow: ellipsis;
    }

    .ride-card .card-body {
        padding: 12px;
    }

                    @@media (min-width: 900px) {
                    /* Pin recent requests to the right as a fixed column on large screens */
                    .recent-requests-section {
                        position: fixed;
                        right: 16px;
                        top: 100px;
                        width: 520px;
                        z-index: 1200;
                        background: rgba(255,255,255,0.98);
                        padding: 8px;
                        border-radius: 6px;
                        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
                        /* Make the panel scrollable so long lists don't extend past the viewport */
                        max-height: calc(100vh - 140px);
                        overflow: auto;
                    }

                    /* Stack cards vertically inside the fixed column and ensure they size to the column */
                    .cards-grid {
                        display: flex;
                        flex-direction: column;
                        gap: 12px;
                        align-items: stretch;
                    }

                    .cards-grid .card {
                        flex: none;
                        width: 100%;
                        max-width: 100%;
                        min-width: 0;
                    }

                    /* ensure the pinned panel receives pointer events and sits above map layers */
                    .recent-requests-section {
                        pointer-events: auto;
                        z-index: 99999; /* ensure it sits above any map overlays */
                    }

                    /* sticky container inside the scrollable panel so the button remains visible */
                    .load-more-container {
                        position: -webkit-sticky; /* Safari */
                        position: sticky;
                        bottom: 0;
                        background: linear-gradient(rgba(255,255,255,0), rgba(255,255,255,0.98));
                        padding: 8px 8px 8px 8px;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 100000;
                        pointer-events: auto;
                    }

                    .load-more-container .btn {
                        pointer-events: auto;
                        z-index: 100001;
                        display: block;
                        width: calc(100% - 16px);
                        max-width: 420px;
                        background: #fff;
                        border-radius: 6px;
                        box-shadow: 0 2px 6px rgba(0,0,0,0.08);
                        border: 1px solid rgba(0,0,0,0.06);
                    }

                    .ride-card .card-text {
                        white-space: nowrap;
                    }
                }

                    @@media (max-width: 899px) {
                    /* Mobile: make the recent requests inline and full-width */
                    .recent-requests-section { position: static; width: 100%; padding: 0; box-shadow: none; }
                    .cards-grid { display:flex; flex-wrap: wrap; justify-content: flex-end; }
                    .cards-grid .card { flex: 0 0 100%; max-width: 100%; }
                    .ride-card .card-text { white-space: normal; }
                }
</style>

@* Form to submit a RideRequest (POST) *@


<div data-baseweb="block" class="css-PKJb">
    <section data-baseweb="block" class="css-gqcHgx">
        <div data-baseweb="block" class="css-hazmlH">
            <div data-baseweb="block" class="css-dpHrtI">
                <div data-baseweb="block" class="container-inner css-lpinv">
                    <div data-baseweb="block" data-testid="block-container" class="css-bVFrLX">
                        <div data-baseweb="block" class="css-gKercT">
                            <div data-baseweb="block" class="css-jnOCnc">
                                <div data-testid="content-group-dynamic" class="css-dkcVmX">
                                    <div data-baseweb="block" class="css-PKJb">
                                        <div class="css-etjCRc">
                                            <div data-testid="dotcom-ui.heading" class="css-hPnljU">
                                                <h1 data-testid="heading.base" class="css-bIdYaZ">Request a ride</h1>
                                            </div>

                                            @* Simple POST form (separate from the existing complex UI). This demonstrates model binding of typed Date/Time. *@
                                            @* <form method="post" action="@Url.Action("Index", "Home")">
                                                @Html.AntiForgeryToken()
                                                <div style="margin:12px 0;">
                                                    <label>Pickup<br />
                                                        <input type="text" name="Pickup"
                                                            value="@(Model?.NewRequest?.Pickup ?? String.Empty)" />
                                                    </label>
                                                </div>
                                                <div style="margin:12px 0;">
                                                    <label>Dropoff<br />
                                                        <input type="text" name="Dropoff"
                                                            value="@(Model?.NewRequest?.Dropoff ?? String.Empty)" />
                                                    </label>
                                                </div>
                                                <div style="margin:12px 0;">
                                                    <label>Date<br />
                                                        <input type="date" name="Date"
                                                            value="@(Model?.NewRequest?.Date?.ToString("yyyy-MM-dd") ?? String.Empty)" />
                                                    </label>
                                                </div>
                                                <div style="margin:12px 0;">
                                                    <label>Time<br />
                                                        <input type="time" name="Time"
                                                            value="@(Model?.NewRequest?.Time?.ToString(@"hh\:mm") ?? String.Empty)" />
                                                    </label>
                                                </div>
                                                <div style="margin:12px 0;">
                                                    <button type="submit" class="css-cxqKro">Request ride</button>
                                                </div>

                                                
                                            </form> *@
                                        </div>
                                    </div>


                                </div>
                                <div data-baseweb="block" data-testid="child-content-desktop" class="css-bKLnG">
                                    <form method="post">
                                        @Html.AntiForgeryToken()
                                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })

                                        <div class="css-cInfKi">
                                            <div>
                                                <div data-testid="cro-map-hero.ride.form-and-cta-container"
                                                    class="css-bgjXJM">
                                                    <div class="css-eqICon">
                                                        <div class="css-UtXZf">
                                                            <div data-baseweb="block" class="css-bunVky">
                                                                <div style="position: relative;">
                                                                    @* <label class="css-dGWkvU"
                                                                        for="rv-pudo-select-0.t306yk7yoc">
                                                                        <p data-baseweb="typo-paragraphmedium"
                                                                            class="css-cNJbLP">Pickup location</p>
                                                                    </label> *@
                                                                    <div data-uweb-guide-key="RV_PUDO_PICKUP_INPUT">
                                                                        <div data-baseweb="select"
                                                                            data-testid="pudo-select-v2"
                                                                            class="css-gpyJyz">
                                                                            <div class="css-jmfNpg">
                                                                                <div class="css-jrqkC">
                                                                                    <svg width="20" height="20"
                                                                                        viewBox="0 0 24 24" fill="none"
                                                                                        data-baseweb="icon">
                                                                                        <title>search</title>
                                                                                        <path fill-rule="evenodd"
                                                                                            clip-rule="evenodd"
                                                                                            d="M12 23c6.075 0 11-4.925 11-11S18.075 1 12 1 1 5.925 1 12s4.925 11 11 11Zm0-8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
                                                                                            fill="currentColor"></path
                                                                                            </svg>
                                                                                </div>

                                                                                <div data-tracking="disabled"
                                                                                    aria-label="pickup location input"
                                                                                    class="css-kImiCK">
                                                                                    <div class="css-kLKDje">
                                                                                        <input aria-autocomplete="list"
                                                                                            aria-expanded="false"
                                                                                            aria-haspopup="listbox"
                                                                                            aria-label="Pickup location needs to be filled in"
                                                                                            role="combobox" tabindex="0"
                                                                                            data-testid="dotcom-ui.pickup-destination.input.pickup"
                                                                                            inputmode="text"
                                                                                            asp-for="NewRequest.Pickup"
                                                                                            class="css-fsnQlw"
                                                                                            placeholder="Pickup location"
                                                                                            required />
                                                                                        <div class="css-EEyoV"></div>
                                                                                    </div>
                                                                                    <span class="text-danger" asp-validation-for="NewRequest.Pickup"></span>

                                                                                    <div data-testid="dotcom-ui.pickup-destination.placeholder.pickup"
                                                                                        class="css-jfDTkw"></div>
                                                                                </div>

                                                                                <div data-testid="clear-button"
                                                                                    class="css-cWhSmV css-jYsWkC">
                                                                                    <div class="css-cmdxYm">
                                                                                        <svg width="1em" height="1em"
                                                                                            viewBox="0 0 24 24"
                                                                                            fill="none"
                                                                                            aria-label="Auto-fill my location"
                                                                                            class="pe-location-fetch css-bOZeEP"
                                                                                            role="button" tabindex="0">
                                                                                            <path
                                                                                                d="M10.5 13.5.5 11 21 3l-8 20.5-2.5-10Z"
                                                                                                fill="currentColor">
                                                                                            </path>
                                                                                        </svg>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div data-baseweb="block" class="css-ldbowJ">
                                                                <div style="position: relative;">
                                                                    @* <label class="css-dGWkvU"
                                                                        for="rv-pudo-select-0.x21rktt57v">
                                                                        <p data-baseweb="typo-paragraphmedium"
                                                                            class="css-cNJbLP">Dropoff location</p>
                                                                    </label> *@

                                                                    <div
                                                                        data-uweb-guide-key="RV_PUDO_DESTINATION_INPUT">
                                                                        <div data-baseweb="select"
                                                                            data-testid="pudo-select-v2"
                                                                            class="css-gpyJyz">
                                                                            <div class="css-jmfNpg">
                                                                                <div class="css-jrqkC">
                                                                                    <svg width="20" height="20"
                                                                                        viewBox="0 0 24 24" fill="none"
                                                                                        data-baseweb="icon">
                                                                                        <title>search</title>
                                                                                        <path fill-rule="evenodd"
                                                                                            clip-rule="evenodd"
                                                                                            d="M22 2H2v20h20V2Zm-7 7H9v6h6V9Z"
                                                                                            fill="currentColor"></path>
                                                                                    </svg>
                                                                                </div>
                                                                                <div data-tracking="disabled"
                                                                                    aria-label="destination location input"
                                                                                    class="css-kImiCK">
                                                                                    <div class="css-kLKDje">
                                                                                        <input aria-autocomplete="list"
                                                                                            aria-expanded="false"
                                                                                            aria-haspopup="listbox"
                                                                                            aria-label="Dropoff location needs to be filled in"
                                                                                            role="combobox" tabindex="0"
                                                                                            data-testid="dotcom-ui.pickup-destination.input.destination.drop0"
                                                                                            inputmode="text"
                                                                                            asp-for="NewRequest.Dropoff"
                                                                                            class="css-fsnQlw"
                                                                                            placeholder="Dropoff location"
                                                                                            required />
                                                                                        <div class="css-EEyoV"></div>
                                                                                    </div>
                                                                                    <span class="text-danger" asp-validation-for="NewRequest.Dropoff"></span>

                                                                                    <div data-testid="dotcom-ui.pickup-destination.placeholder.destination.drop0"
                                                                                        class="css-jfDTkw"></div>
                                                                                </div>


                                                                                <div data-testid="clear-button"
                                                                                    class="css-cWhSmV css-jYsWkC"></div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>



                                                            <div class="css-jkbjYp"></div>
                                                        </div>


                                                        <div data-baseweb="block" class="css-cvpIEi css-ebzWAP"
                                                            data-testid="dotcom-ui.data-time-picker-container.default"
                                                            data-uweb-guide-key="DOTCOM_UI_COMBINED_DATE_TIME_CONTAINER">
                                                            <div class="css-cYTjpz">
                                                                <label for="trip-form-date-picker-0.hwc12kfh17n">
                                                                    <p data-baseweb="typo-paragraphsmall"
                                                                        class="css-hljex">
                                                                        Date</p>
                                                                </label>
                                                                <div class="css-Qbhli"
                                                                    data-uweb-guide-key="DATE_PICKER">
                                                                    <div class="css-cYTjpz">
                                                                        <div data-baseweb="input" class="css-hnpcQn">
                                                                            <div data-baseweb="base-input"
                                                                                class="css-gKbRfz">
                                                                                <input aria-label="Select a date."
                                                                                    aria-invalid="false"
                                                                                    autocomplete="on"
                                                                                    asp-for="NewRequest.Date" type="date"
                                                                                    data-testid="dotcom-ui.date-picker.input"
                                                                                    class="css-eSRvYO"
                                                                                    aria-describedby="uid1" required />
                                                                            </div>
                                                                            <span class="text-danger" asp-validation-for="NewRequest.Date"></span>
                                                                        </div>
                                                                    </div>


                                                                    <p id="uid1"
                                                                        style="position: fixed; width: 0px; height: 0px; border-width: 0px; padding: 0px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); clip-path: inset(100%);">
                                                                        Press the down arrow key to interact with the
                                                                        calendar and select a date. Press the escape
                                                                        button
                                                                        to close the calendar.</p>

                                                                    <p aria-live="assertive"
                                                                        style="position: fixed; width: 0px; height: 0px; border-width: 0px; padding: 0px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); clip-path: inset(100%);">
                                                                    </p>

                                                                    <div class="css-fCLXtX">
                                                                        <svg width="1em" height="1em"
                                                                            viewBox="0 0 24 24" fill="none"
                                                                            aria-hidden="true" color="#000000"
                                                                            data-testid="calendar-filled">
                                                                            <title>Calendar</title>
                                                                            <path fill-rule="evenodd"
                                                                                clip-rule="evenodd"
                                                                                d="M23 8V4h-3V1h-3v3H7V1H4v3H1v4h22Zm0 15H1V10h22v13ZM8 14H5v3h3v-3Z"
                                                                                fill="currentColor"></path>
                                                                        </svg>
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <div class="css-cYTjpz"><label
                                                                    for="trip-form-time-picker-0.pao1yvz8h6e">
                                                                    <p data-baseweb="typo-paragraphsmall"
                                                                        class="css-hljex">
                                                                        Time</p>
                                                                </label>
                                                                <div class="css-Qbhli">
                                                                    <div class="css-">
                                                                        <div class="css-ehJLpI">
                                                                            <div class="css-hQrlmS">
                                                                                <div>
                                                                                    <input asp-for="NewRequest.Time" type="time"
                                                                                        style="margin-left: 22px" />
                                                                                    
                                                                                </div>


                                                                            </div>



                                                                        </div>
                                                                    </div>



                                                                    <div class="css-fCLXtX">
                                                                        <svg width="1em" height="1em"
                                                                            viewBox="0 0 24 24" fill="none"
                                                                            aria-hidden="true" color="#000000"
                                                                            data-testid="clock-filled">
                                                                            <title>Clock</title>
                                                                            <path
                                                                                d="M12 1C5.9 1 1 5.9 1 12s4.9 11 11 11 11-4.9 11-11S18.1 1 12 1Zm6 13h-8V4h3v7h5v3Z"
                                                                                fill="currentColor"></path>
                                                                        </svg>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @* <div>
                                                        <p data-baseweb="typo-paragraphmedium" class="css-dTqljZ">
                                                            Destination suggestions</p>
                                                        <div data-testid="RevealAnimationWrapper"
                                                            style="height: auto; opacity: 1; overflow: hidden; transition: 1s;">
                                                            <button aria-label="destination shortcut item"
                                                                data-tracking="disabled"
                                                                data-testid="dotcom-ui.location-suggestion"
                                                                class="css-gQFwWm">
                                                                <div class="css-jnYoLS">
                                                                    <svg width="16" height="16" viewBox="0 0 24 24"
                                                                        fill="none">
                                                                        <title>Clock</title>
                                                                        <path
                                                                            d="M12 1C5.9 1 1 5.9 1 12s4.9 11 11 11 11-4.9 11-11S18.1 1 12 1Zm6 13h-8V4h3v7h5v3Z"
                                                                            fill="currentColor"></path>
                                                                    </svg>
                                                                </div>

                                                                <div data-tracking="disabled"
                                                                    aria-label="destination shortcut item"
                                                                    class="css-dWzzPr">
                                                                    <div class="css-bZYltD">
                                                                        <p class="css-jYoXid">Dallas Fort Worth
                                                                            International Airport (DFW)</p>
                                                                        <p class="css-eJDa-Df">2400 Aviation Dr, DFW
                                                                            Airport, TX</p>
                                                                    </div>
                                                                </div>
                                                            </button>

                                                            <button aria-label="destination shortcut item"
                                                                data-tracking="disabled"
                                                                data-testid="dotcom-ui.location-suggestion"
                                                                class="css-gQFwWm">
                                                                <div class="css-jnYoLS"><svg width="16" height="16"
                                                                        viewBox="0 0 24 24" fill="none">
                                                                        <title>Clock</title>
                                                                        <path
                                                                            d="M12 1C5.9 1 1 5.9 1 12s4.9 11 11 11 11-4.9 11-11S18.1 1 12 1Zm6 13h-8V4h3v7h5v3Z"
                                                                            fill="currentColor"></path>
                                                                    </svg></div>
                                                                <div data-tracking="disabled"
                                                                    aria-label="destination shortcut item"
                                                                    class="css-dWzzPr">
                                                                    <div class="css-bZYltD">
                                                                        <p class="css-jYoXid">Dallas Love Field Airport
                                                                            (DAL)</p>
                                                                        <p class="css-eJDa-Df">8008 Herb Kelleher Way,
                                                                            Dallas, TX</p>
                                                                    </div>
                                                                </div>
                                                            </button>
                                                        </div>
                                                    </div> *@
                                                    <div style="margin:12px 0;">
                                                        <div style="margin:12px 0;" class="css-jmfNpg">
                                                                <input asp-for="NewRequest.Name" type="text" class="css-fsnQlw" placeholder="Name" required />
                                                                <span class="text-danger" asp-validation-for="NewRequest.Name"></span>
                                                            </div>
                                                            <div style="margin:12px 0;" class="css-jmfNpg">
                                                                <input asp-for="NewRequest.Contact" type="text" class="css-fsnQlw" placeholder="Contact(number/FBMessengerLink)" required />
                                                                <span class="text-danger" asp-validation-for="NewRequest.Contact"></span>
                                                            </div>



                                                        <div style="margin:12px 0;">
                                                            <button type="submit" class="css-cxqKro">Request
                                                                ride</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                            @* Submission confirmation (shows last submitted values when present) *@
                                            @if (ViewData["Submitted"] != null)
                                            {
                                                <div style="margin-top:12px;padding:8px;border:1px solid #ccc;">
                                                    <strong>Submitted:</strong>
                                                    <div>Pickup: @Model?.NewRequest?.Pickup</div>
                                                    <div>Dropoff: @Model?.NewRequest?.Dropoff</div>
                                                    <div>Date: @Model?.NewRequest?.Date?.ToString("yyyy-MM-dd")</div>
                                                    <div>Time: @Model?.NewRequest?.Time?.ToString(@"hh\:mm")</div>
                                                </div>
                                            }
                                    </form>


                                </div>
                            </div>


                            


                            <div class="recent-requests-section" style="margin:16px 0;">
                                <h2 class="css-bIdYaZ">Recent ride requests</h2>
                                <div class="cards-grid d-flex flex-wrap">
                                    @if (Model?.RecentRequests != null && Model.RecentRequests.Any())
                                    {
                                        foreach (var req in Model.RecentRequests)
                                        {
                                            @await Html.PartialAsync("_RideRequestCard", req)
                                        }
                                    }
                                    else
                                    {
                                        <div>No recent requests to show.</div>
                                    }
                                </div>

                                @{ var next = (Model?.Skip ?? 0) + (Model?.Take ?? 11); }
                                <div id="load-more-sentinel" data-skip="@(next)" data-take="@(Model?.Take ?? 11)" style="margin-top:12px; display:flex; justify-content:center; align-items:center; min-height:32px;"></div>
                            </div>

                            @* <div data-baseweb="block" class="css-hHlspe"
                                data-uweb-guide-key="MAP_HERO_SIDE_MEDIA_WRAPPER">
                                <div data-baseweb="block" class="css-PKJb">
                                    <div data-baseweb="aspect-ratio-box" class="css-eENBEE">
                                        <div class="css-kpjDOI">
                                            <div aria-label="Map" class="css-gCDjHu">
                                                <div class="css-LsYmB">
                                                    <div id="deckgl-wrapper" tabindex="0"
                                                        style="position: absolute; z-index: 0; left: 0px; top: 0px; width: 100%; height: 100%; pointer-events: all; touch-action: none; -webkit-user-select: none; -webkit-user-drag: none; outline: currentcolor; cursor: grab;">
                                                        <canvas id="deckgl-overlay" width="1018" height="1018"
                                                            style="left: 0px; top: 0px; width: 100%; position: absolute; height: 100%;"></canvas>
                                                        <div class="deck-tooltip"
                                                            style="z-index: 1; position: absolute; pointer-events: none; color: rgb(160, 167, 180); background-color: rgb(41, 50, 60); padding: 10px; top: 0px; left: 0px; display: none;">
                                                        </div>
                                                        <div id="view-default-view"
                                                            style="position: absolute; left: 0px; top: 0px; width: 1018px; height: 1018px;">
                                                            <div
                                                                style="position: absolute; z-index: -1; width: 1018px; height: 1018px;">
                                                                <div class="mapboxgl-map"
                                                                    style="position: absolute; width: 100%; height: 100%; overflow: hidden; visibility: inherit;">
                                                                    <div class="mapboxgl-canary"
                                                                        style="visibility: hidden;"></div>
                                                                    <div class="mapboxgl-canvas-container"><canvas
                                                                            class="mapboxgl-canvas" tabindex="0"
                                                                            aria-label="Map" width="1018" height="1018"
                                                                            style="width: 509px; height: 509px; outline: currentcolor;"></canvas>
                                                                    </div>
                                                                    <div class="mapboxgl-control-container">
                                                                        <div class="mapboxgl-ctrl-top-left"></div>
                                                                        <div class="mapboxgl-ctrl-top-right"></div>
                                                                        <div class="mapboxgl-ctrl-bottom-left">
                                                                            <div class="mapboxgl-ctrl"
                                                                                style="display: none;"><a
                                                                                    class="mapboxgl-ctrl-logo"
                                                                                    target="_blank"
                                                                                    rel="noopener nofollow"
                                                                                    href="https://www.mapbox.com/"
                                                                                    aria-label="Mapbox logo"></a></div>
                                                                        </div>
                                                                        <div class="mapboxgl-ctrl-bottom-right">
                                                                            <div
                                                                                class="mapboxgl-ctrl mapboxgl-ctrl-attrib mapboxgl-attrib-empty mapboxgl-compact">
                                                                                <div class="mapboxgl-ctrl-attrib-inner">
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div
                                                                    style="overflow: visible; height: 0px; width: 0px;">
                                                                    <div class="overlays"
                                                                        style="position: absolute; width: 100%; height: 100%; overflow: hidden;">
                                                                    </div>
                                                                </div>
                                                                <div class="resize-triggers">
                                                                    <div class="expand-trigger">
                                                                        <div style="width: 510px; height: 510px;"></div>
                                                                    </div>
                                                                    <div class="contract-trigger"></div>
                                                                </div>
                                                            </div>
                                                            <div
                                                                style="z-index: auto; width: 100%; height: 100%; position: absolute; pointer-events: none; overflow: hidden;">
                                                            </div>
                                                            <div
                                                                style="z-index: auto; width: 100%; height: 100%; position: absolute; pointer-events: none; overflow: hidden;">
                                                            </div>
                                                            <div
                                                                style="z-index: auto; width: 100%; height: 100%; position: absolute; pointer-events: none; overflow: hidden;">
                                                            </div>
                                                            <div
                                                                style="z-index: auto; width: 100%; height: 100%; position: absolute; pointer-events: none; overflow: hidden;">
                                                            </div>
                                                            <div
                                                                style="z-index: auto; width: 100%; height: 100%; position: absolute; pointer-events: none; overflow: hidden;">
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="css-olPEc">
                                                        <div class="css-PWMTc"><button data-baseweb="button"
                                                                aria-label="Zoom in" type="button"
                                                                name="maps-sdk-map-controls-zoom-in"
                                                                class="css-fhEDvq"><svg width="18px" height="18px"
                                                                    viewBox="0 0 24 24" fill="none">
                                                                    <title>Plus</title>
                                                                    <path
                                                                        d="M23 10.5h-9.5V1h-3v9.5H1v3h9.5V23h3v-9.5H23v-3Z"
                                                                        fill="currentColor"></path>
                                                                </svg></button>
                                                            <div class="css-hCJOEw"></div><button data-baseweb="button"
                                                                aria-label="Zoom out" type="button"
                                                                name="maps-sdk-map-controls-zoom-out"
                                                                class="css-gNmhpO"><svg width="18px" height="18px"
                                                                    viewBox="0 0 24 24" fill="none">
                                                                    <title>Minus</title>
                                                                    <path d="M23 10.5H1v3h22v-3Z" fill="currentColor">
                                                                    </path>
                                                                </svg></button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div data-baseweb="block" class="css-iaCKOd"
                                data-uweb-guide-key="MAP_HERO_SIDE_MEDIA_WRAPPER">
                                <div data-baseweb="block" class="css-PKJb">
                                    <div data-baseweb="aspect-ratio-box" class="css-eENBEE">

                                    </div>
                                </div>
                            </div> *@
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<script>
    // Mobile form: copy desktop values into hidden fields before submit so mobile form submits the full NewRequest
    (function(){
        const form = document.getElementById('mobile-contact-form');
        if (!form) return;

        function ensureHiddenInput(name, value){
            let input = form.querySelector('input[name="' + name + '"]');
            if (!input){
                input = document.createElement('input');
                input.type = 'hidden';
                input.name = name;
                form.appendChild(input);
            }
            input.value = value ?? '';
        }

        form.addEventListener('submit', function(e){
            // copy values from page inputs (try several selectors)
            const mapName = {
                'NewRequest.Pickup': ['input[name="NewRequest.Pickup"]','input[name="Pickup"]','input[id$="Pickup"]'],
                'NewRequest.Dropoff': ['input[name="NewRequest.Dropoff"]','input[name="Dropoff"]','input[id$="Dropoff"]'],
                'NewRequest.Date': ['input[name="NewRequest.Date"]','input[name="Date"]','input[id$="Date"]'],
                'NewRequest.Time': ['input[name="NewRequest.Time"]','input[name="Time"]','input[id$="Time"]']
            };

            for (const key of Object.keys(mapName)){
                const selectors = mapName[key];
                let val = '';
                for (const sel of selectors){
                    const el = document.querySelector(sel);
                    if (el && el.value !== undefined){ val = el.value; break; }
                }
                ensureHiddenInput(key, val);
            }

            // allow submit to continue
        });
    })();

    // Infinite scroll implementation (IntersectionObserver)
    (function(){
        console.debug('Infinite scroll initializing');
        let loading = false;
        const container = document.querySelector('.cards-grid');
        const panel = document.querySelector('.recent-requests-section'); // scroll root for observer
        const sentinel = document.getElementById('load-more-sentinel');

        function showSpinner() {
            if (!sentinel) return;
            // avoid creating multiple spinners
            if (sentinel._spinner) return;
            const sp = document.createElement('div');
            sp.setAttribute('aria-hidden','true');
            // spinner visual styles
            Object.assign(sp.style, {
                width: '20px',
                height: '20px',
                border: '3px solid #ddd',
                borderTopColor: '#333',
                borderRadius: '50%',
                boxSizing: 'border-box',
                display: 'inline-block'
            });
            sentinel.appendChild(sp);
            // animate with requestAnimationFrame to avoid needing the keyframes CSS rule
            let angle = 0;
            function raf() {
                angle = (angle + 8) % 360;
                sp.style.transform = 'rotate(' + angle + 'deg)';
                sentinel._spinRAF = requestAnimationFrame(raf);
            }
            sentinel._spinner = sp;
            sentinel._spinRAF = requestAnimationFrame(raf);
        }
        function hideSpinner() {
            if (!sentinel) return;
            if (sentinel._spinRAF) { cancelAnimationFrame(sentinel._spinRAF); sentinel._spinRAF = null; }
            if (sentinel._spinner) { sentinel._spinner.remove(); sentinel._spinner = null; }
        }

        async function loadNext() {
            if (loading || !sentinel) return;
            loading = true;
            const skip = parseInt(sentinel.getAttribute('data-skip') || '0', 10);
            const take = parseInt(sentinel.getAttribute('data-take') || '11', 10);
            const url = '/Home/LoadMore?skip=' + skip + '&take=' + take;
            try{
                showSpinner();
                console.debug('Fetching', url);
                const resp = await fetch(url, { credentials: 'same-origin' });
                console.debug('Fetch response', resp.status, resp.ok);
                if (!resp.ok) throw new Error('Network response not ok');
                const html = await resp.text();
                if (!container) throw new Error('cards-grid container missing');

                if (html.trim().length === 0){
                    // no more items — disconnect observer
                    if (sentinel._observer) sentinel._observer.disconnect();
                    sentinel.style.display = 'none';
                } else {
                    const temp = document.createElement('div');
                    temp.innerHTML = html;
                    while (temp.firstChild){ container.appendChild(temp.firstChild); }
                    // update skip for next load
                    const next = skip + take;
                    sentinel.setAttribute('data-skip', next.toString());
                }
            }catch(err){
                console.error('Infinite load failed', err);
            } finally {
                hideSpinner();
                loading = false;
            }
        }

        if (sentinel && 'IntersectionObserver' in window){
            try{
                const observer = new IntersectionObserver(entries => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting){
                            loadNext();
                        }
                    });
                }, {
                    root: panel || null,
                    rootMargin: '200px',
                    threshold: 0.1
                });
                observer.observe(sentinel);
                sentinel._observer = observer;
            }catch(e){ console.debug('IntersectionObserver failed to initialize', e); }
        }
        // spinner is animated via requestAnimationFrame; no injected CSS needed
    })();
</script>